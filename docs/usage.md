# Japan Opendataプラグインの使い方

## 目的

この資料では、ChatGPTを使用してJapan Opendataプラグインを活用し、東京都の子育てに関する施設の一覧を検索・保存する方法を学びます。

## Japan Opendataのインストール方法
ChatGPT Pluginの機能をONにして、プラグインストアで「Japan Opendata」と検索してインストールしてください。

<img width="472" alt="image" src="https://github.com/FooQoo/japan-opendata-chatgpt-plugin/assets/14051784/442236a3-2ced-4eb4-b3df-8b60c13707b2">


## 題材となるプロンプト

Japan OpendataプラグインをONにして、以下のプロンプトを送ることで、東京都の子育てに関する施設の一覧を検索・保存できます。

### プロンプト
```
ステップ1: オープンデータを検索
ChatGPTにjapan_opendata.searchOpenData APIを使用して、東京都の子育てに関する施設（例：公園、子育て支援施設）の一覧を検索します。
キーワードは「子育て施設」と「公園」、組織は「東京都」を指定します。

ステップ2: 検索結果を表示
検索結果から、東京都内の各自治体の子育てに関する施設（例：公園、子育て支援施設）のデータセットを見つけます。
データセットの名称とダウンロードリンクを保存します。

ステップ3: リスト作成
ステップ2で得られた情報をJSON形式で保存します。
各エントリには「自治体名」、「データセット名称」、「ダウンロードリンク」、そして「検索ワード（キーワード）」を含めます。

ループ処理
ステップ1からステップ3を、東京都内のすべての子育てに関する施設（例：公園、子育て支援施設）が網羅されるまで繰り返します。
```

## プロンプトの解説

さきほどのプロンプトを、各ステップごとに分解してみましょう。

### ステップ1: オープンデータを検索

1. ChatGPTにjapan_opendata.searchOpenData APIを使用します。
2. 検索キーワードとして「子育て施設」と「公園」を指定します。
3. 検索組織として「東京都」を指定します。

#### プロンプト

```
ステップ1: オープンデータを検索
ChatGPTにjapan_opendata.searchOpenData APIを使用して、東京都の子育てに関する施設（例：公園、子育て支援施設）の一覧を検索します。
キーワードは「子育て施設」と「公園」、組織は「東京都」を指定します。
```

#### 出力結果の例

```
### ステップ1: オープンデータを検索
検索条件:
- キーワード: 子育て施設, 公園
- 組織: 東京都

合計ヒット数: 17,795件
```

### ステップ2: 検索結果を表示

1. APIのレスポンスから、東京都内の各自治体の子育てに関する施設のデータセットを探します。
2. 各データセットの名称とダウンロードリンクを確認します。

#### プロンプト

```
ステップ2: 検索結果を表示
検索結果から、東京都内の各自治体の子育てに関する施設（例：公園、子育て支援施設）のデータセットを見つけます。
データセットの名称とダウンロードリンクを保存します。
```

#### 出力結果の例
```
ステップ2: 検索結果を表示
以下は、東京都内の各自治体の子育てに関する施設（例：公園、子育て支援施設）のデータセットです。

1. 自治体名: 江戸川区
   - データセット名称: [131237_東京都_江戸川区_保育・子育て支援施設](https://www.geospatial.jp/ckan/dataset/13123-009)
   - ダウンロードリンク: [CSV](https://www.geospatial.jp/ckan/dataset/2e6ebade-e998-432a-9825-3c1741f8cade/resource/5d1a13e4-9338-4e02-9c04-41ee4774d4e0/download/1312320150914kosodate.csv)
   - 検索ワード: 子育て施設

2. 自治体名: 杉並区
   - データセット名称: [131156_東京都_杉並区_公園・スポーツ施設](https://www.geospatial.jp/ckan/dataset/13115-014)
   - ダウンロードリンク: [SHP](https://www.geospatial.jp/ckan/dataset/31864ef5-c91a-4ad0-8a51-90fd9ac16c16/resource/1812bd94-8364-4dde-be84-2e5a0a70d813/download/13115koenryokuchi.zip)
   - 検索ワード: 公園

3. 自治体名: 稲城市
   - データセット名称: [132250_東京都_稲城市_保育・子育て支援施設](https://www.geospatial.jp/ckan/dataset/13225-009)
   - ダウンロードリンク: [CSV](https://www.geospatial.jp/ckan/dataset/b0efb378-64b6-48f7-827c-ec3aec355f44/resource/74097b7f-aeea-4e18-a06e-1128b14eed9e/download/13225c191.csv)
   - 検索ワード: 子育て施設

4. 自治体名: 東村山市
   - データセット名称: [132136_東京都_東村山市_公園・スポーツ施設](https://www.geospatial.jp/ckan/dataset/13213-014)
   - ダウンロードリンク: [CSV](https://www.geospatial.jp/ckan/dataset/4800b0ff-23d1-43c6-999a-67547a38c4d9/resource/dc34b82f-00d0-4c44-ab9c-7e64a71d5329/download/13213koen.csv)
   - 検索ワード: 公園

5. 自治体名: 江戸川区
   - データセット名称: [131237_東京都_江戸川区_公園・スポーツ施設](https://www.geospatial.jp/ckan/dataset/13123-014)
   - ダウンロードリンク: [CSV](https://www.geospatial.jp/ckan/dataset/9916b3b3-514a-44be-8c21-56b273c8819a/resource/f99306f9-f8e6-4295-bce6-cb0c30cfbb97/download/1312320151210park.csv)
   - 検索ワード: 公園

[さらに詳細を見る](https://search.ckan.jp/?q=%E5%AD%90%E8%82%B2%E3%81%A6%E6%96%BD%E8%A8%AD%20%E5%85%AC%E5%9C%92%20%E6%9D%B1%E4%BA%AC%E9%83%BD)
```

#### 注意点

- データセットの数や内容は、検索条件や時期によって異なる場合があります。
- 必要な情報が見つからない場合は、キーワードや組織の指定を見直して再検索することが推奨されます。

### ステップ3: リスト作成

1. ステップ2で得られた情報をJSON形式で保存します。
2. JSONの各エントリには以下の情報を含めます：
    - 「自治体名」
    - 「データセット名称」
    - 「ダウンロードリンク」
    - 「検索ワード（キーワード）」

#### プロンプト
```
ステップ3: リスト作成
ステップ2で得られた情報をJSON形式で保存します。
各エントリには「自治体名」、「データセット名称」、「ダウンロードリンク」、そして「検索ワード（キーワード）」を含めます。
```

#### 出力結果の例
```
### ステップ3: リスト作成
以下は、ステップ2で得られた情報をJSON形式で保存したものです。

[
  {
    "自治体名": "江戸川区",
    "データセット名称": "131237_東京都_江戸川区_保育・子育て支援施設",
    "ダウンロードリンク": "https://www.geospatial.jp/ckan/dataset/2e6ebade-e998-432a-9825-3c1741f8cade/resource/5d1a13e4-9338-4e02-9c04-41ee4774d4e0/download/1312320150914kosodate.csv",
    "検索ワード": "子育て施設"
  },
  ...
]
```

#### 注意点

- JSON形式での保存は、後でのデータの利用や分析を容易にするためです。
- 必要に応じて、他の情報もエントリに追加するできます。

### ループ処理

1. ステップ1からステップ3を繰り返します。
2. 東京都内のすべての子育てに関する施設が網羅されるまでこのループを続けます。

#### プロンプト
```
ループ処理
ステップ1からステップ3を、東京都内のすべての子育てに関する施設（例：公園、子育て支援施設）が網羅されるまで繰り返します。
```

#### 出力結果の例
```
### ループ処理
以下は、東京都内のすべての子育てに関する施設（例：公園、子育て支援施設）のデータセットです。

1. 自治体名: 江戸川区
   - データセット名称: [131237_東京都_江戸川区_保育・子育て支援施設](https://www.geospatial.jp/ckan/dataset/13123-009)
   - ダウンロードリンク: [CSV](https://www.geospatial.jp/ckan/dataset/2e6ebade-e998-432a-9825-3c1741f8cade/resource/5d1a13e4-9338-4e02-9c04-41ee4774d4e0/download/1312320150914kosodate.csv)
   - 検索ワード: 子育て施設
...
```

#### 注意点

- データセットの数や内容によっては、すべての施設を網羅するのに複数回の検索が必要になる場合があります。

## まとめ

このハンズオンを通じて、Japan Opendataプラグインを使用してオープンデータを検索・保存する基本的な手順を学びました。  
実際のデータ検索や利用に際しては、具体的な要件や目的に応じて手順を調整することが必要です。

## おまけ:演習

先ほどの例以外で以下のプロンプトを試してみましょう。

### 東京都の育児施設を検索するプロンプト

```
"組織A"：東京都
"検索ワードA"：育児施設
以下において、A=「"組織A"が提供する"場所A"の"検索ワードA"」とします。
これからAに関するオープンデータを提供してもらいます。
ステップごとに考えてみましょう。

#ステップ1
Japan OpenDataのプラグインを利用して、Aに関するオープンデータを5件教えてください。
##Aに関する適切なオープンデータが見つかった場合
出力は、
・データセットのタイトル
・データセットのURL
・データセットの説明
・データのフォーマット:
以上に加えて、最後に、
「例として以上のオープンデータがありますが、どれかについて詳細をお知りになりたいですか？」としてください。
その後、ステップ2に進んでください。

##Aに関する適切なオープンデータが見つからない場合
「Aに関する適切なオープンデータは見つからなかったため、Aを代替する検索ワードを3つ検索します。」と出力してください。
その後、ステップ1-2に進んでください。

#ステップ1-2
"検索ワードA"を代替する検索ワードを3つ考案してください。（検索ワードB1、検索ワードB2、検索ワードB3）
"場所A"は変更しないでください。
新しく以下を定義します。
B1＝「"組織A"が提供する"場所A"の"検索ワードB1"」
B1について検索を行い、Aとの関連性が高い検索結果に絞り、3件教えてください。
B2＝「"組織A"が提供する"場所A"の"検索ワードB2"」
B2について検索を行い、Aとの関連性が高い検索結果に絞り、3件教えてください。
B3＝「"組織A"が提供する"場所A"の"検索ワードB3"」
B3について検索を行い、Aとの関連性が高い検索結果に絞り、3件教えてください。
出力は、
・データセットのタイトル
・データセットのURL
・データセットの説明
・データのフォーマット
としてください。
B3までの出力を終えたら、
「例として以上のオープンデータがありますが、どれかについて詳細をお知りになりたいですか？」と出力してください。
ステップ2に進んでください。

#ステップ2
データセットを1つ指定するので、そのデータセットについて以下の項目を出力してください。
出力項目は以下でお願いいたします。
・データセットの名称
・データセットのurl
・データセットの説明
・データセットのリソースの一覧
・フォーマット
・ライセンス
なお、Japan OpenDataのプラグインを用いて再度検索し、リソースのダウンロードリンクを含めてください。
```
